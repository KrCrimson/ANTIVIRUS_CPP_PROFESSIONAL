@startuml UNIFIED_ANTIVIRUS_Sequence
!theme aws-orange
title Flujo de Detecci√≥n de Amenazas - UNIFIED ANTIVIRUS

actor "üë§ Usuario" as User
participant "üñ•Ô∏è Dashboard" as UI
participant "üèõÔ∏è Engine" as Engine
participant "üéõÔ∏è Plugin Manager" as PM
participant "üß† ML Detector" as ML
participant "üëÅÔ∏è Behavior Detector" as BD
participant "üåê Network Detector" as ND
participant "üîç Keylogger Detector" as KD
participant "üì° Event Bus" as EB
participant "üéØ Decision Engine" as DE
participant "üö® Alert Manager" as AM

User -> UI: Iniciar Protecci√≥n
UI -> Engine: start_system()
Engine -> PM: load_plugins()

PM -> ML: initialize()
PM -> BD: initialize() 
PM -> ND: initialize()
PM -> KD: initialize()

note over ML, KD: **Detectores Inicializados**\nMonitoreo en tiempo real

loop Monitoreo Continuo
    
    ML -> EB: scan_process(process_info)
    BD -> EB: analyze_behavior(cpu, memory, io)
    ND -> EB: monitor_connections(network_data)
    KD -> EB: check_signatures(process_hooks)
    
    note over EB: **Event Bus**\nCentraliza comunicaci√≥n
    
    EB -> DE: aggregate_results()
    
    alt Proceso Normal (Sin Amenaza)
        DE -> EB: threat_level: LOW
        EB -> UI: status: PROTECTED ‚úÖ
        
    else Actividad Sospechosa Detectada
        DE -> DE: calculate_threat_score()
        
        alt Amenaza Confirmada (Score > 80%)
            DE -> AM: trigger_alert(CRITICAL)
            AM -> UI: show_threat_dialog() üö®
            AM -> User: notification_popup()
            
            User -> UI: select_action()
            
            alt Usuario: Bloquear
                UI -> Engine: block_process()
                Engine -> PM: terminate_threat()
                
            else Usuario: Cuarentena
                UI -> Engine: quarantine_file()
                Engine -> PM: isolate_threat()
                
            else Usuario: Lista Blanca
                UI -> Engine: whitelist_process()
                Engine -> PM: add_to_whitelist()
            end
            
        else Sospechoso pero no Cr√≠tico (Score 50-80%)
            DE -> AM: trigger_alert(WARNING)
            AM -> UI: show_warning() ‚ö†Ô∏è
            
        end
    end
    
    note over ML, AM: **An√°lisis cada 2 segundos**
    
end

@enduml